---
layout: post
title: Docker知识点【整理中，待更新】
date: 2019-12-25
keywords:
top: 10
categories:
    -
tags:
    -
---
# Docker知识点
## Docker中午学习网站
- [Docker中文学习网站[yeasy]](https://legacy.gitbook.com/book/yeasy/docker_practice/details)
- [Docker中文学习网站[runoob]](https://www.runoob.com/docker/docker-tutorial.html)

# 1.安装
## 1.Debian
- 1.更新包列表
```
sudo apt update
```
- 2.安装必备包
```
sudo apt install apt-transport-https ca-certificates curl gnupg2 software-properties-common
```
- 3.将官方Docker存储库的GPG密钥添加到系统
```
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
```

- 4.将Docker存储库添加到APT源
```
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable"
```
- 5.确保要从Docker repo而不是默认的Debian repo安装
```
apt-cache policy docker-ce

#

docker-ce:
  Installed: (none)
  Candidate: 18.06.1~ce~3-0~debian
  Version table:
     18.06.1~ce~3-0~debian 500
        500 https://download.docker.com/linux/debian stretch/stable amd64 Packages

请注意，未安装docker-ce ，但安装的候选者来自Debian 9的Docker存储库（ stretch ）
```
- 6.安装Docker
```
sudo apt install docker-ce
```

- 7.守护进程&开机自启&启动
```
# 查看状态
sudo systemctl status docker

# 开机自启动
sudo systemctl enable docker

# 启动docker
sudo systemctl start docker

# 关闭docker
sudo systemctl stop docker
```

## 2.Centos
- 1.卸载旧版
```
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
```
- 2.安装Docker Engine-Community。新主机上首次安装Docker Engine-Community之前，需要设置Docker仓库。之后可以从仓库更新和安装Docker。安装所需软件包。
```
sudo yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2
```

- 3.设置稳定仓库
```
sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
```

- 4.安装Docker Engine-Community和containerd（默认最新）
```
sudo yum install docker-ce docker-ce-cli containerd.io
```

- 5.守护进程&开机自启&启动
```
# 查看状态
sudo systemctl status docker

# 开机自启动
sudo systemctl enable docker

# 启动docker
sudo systemctl start docker

# 关闭docker
sudo systemctl stop docker
```
# Dockerfile
## 1.ARG
## 2.ENV
- 脚本中读取变量
```
# Dockerfile
ARG PUBLISH_HOST=default        # 可设置默认值
ENV PUBLISH_HOST $PUBLISH_HOST  # 保证传递参数是可以被ARG的覆盖

# 启动命令
docker build --build-arg PUBLISH_HOST=aValue

# 脚本中正常获取即可
echo $PUBLISH_HOST
```

# 镜像托管
## 1.[Docker Hub](hub.docker.com)
### 1.Github账号连接到Docker Hub

- 打开 [Docker Hub](hub.docker.com) -> 登录 -> 点击Create -> 选择 Create Automated Build -> Linked Accounts -> Link Github -> Public and Private (Recommended) -> Authorize application -> 输入 Github 密码

### 2.自动构建
- 打开 [Docker Hub](hub.docker.com) -> 登录 -> 点击Create -> 选择 Create Automated Build -> 选择Github -> 选择仓库 -> 设置镜像名、描述、public 还是 private -> create -> 在 Build Settings 里选择分支、设置Dockerfile的地址、设置每次构建的标签 -> 更新github仓库，触发自动构建 -> 查看构建详情

# 容器间互相访问
- 1.可以通过设置link
- 2.开放对外端口

## mysql
### 1.启动mysql，同时开放了9333对外端口
```
docker run --name v2ray-mysql -e MYSQL_ROOT_PASSWORD=admin -d -p 9333:3306 mysql mysqld --default-authentication-plugin=mysql_native_password
```

### 2.其余容器访问
- 启动容器
```
docker run -d -p 9001:80 --link v2ray-mysql
```

- link方式连接mysql
```
# 这里 --link了mysql容器的name
# 配置文件中可以按照下方的内容进行配置

host: 'v2ray-mysql',
user: 'root',
password: 'admin',
database: 'test',
port: 3306
```

- 对外端口方式
```
# 启动容器去掉link即可
# 配置文件中可以按照下方的内容进行配置

host: 'ip',
user: 'root',
password: 'admin',
database: 'test',
port: 9333
```

>如有侵权行为，请[点击这里](https://github.com/cooper-q/MattMeng_hexo/issues)联系我删除

>[如发现疑问或者错误点击反馈](https://github.com/cooper-q/MattMeng_hexo/issues)

# 备注

